// as of 2021-10-22, minify with https://minify.js.org/js/ which does NOT require changing "const" to "var" :)
// as of 2021-11-09, minify with https://codebeautify.org/minify-js
const points=[];var totalLength=0;const dCanvas=document.getElementById("dc"),dContext=dCanvas.getContext("2d");var mouseDrag=!1,mouseDragX=0,mouseDragY=0,pinch=!1,pinchStartDist=0,historyParams={},replaceStateTimeout=null,historyTimeout=null,resizeTimeout=null,helpVisible=!1,menuVisible=!1;const windowLogTiming=!0,mandelbrotCircleHeuristic=!1,windowCalc={timeout:null,seqName:"",lineWidth:0,xPixelChunks:[],resultPoints:[],pointsBounds:"",pointsCache:{},totalTimeMs:0,totalPoints:0,cachedPoints:0,chunksComplete:0,totalChunks:0,eachPixUnits:infNum(1n,0n),leftEdge:infNum(0n,0n),topEdge:infNum(0n,0n),rightEdge:infNum(0n,0n),bottomEdge:infNum(0n,0n),n:1};function infNum(e,n){return{v:e,e:n}}function trimZeroes(e){var n=e.trim();const t=n.startsWith("-");for(t&&(n=n.substr(1));n.length>1&&n.startsWith("0");)n=n.substr(1);t&&(n="-"+n);const o=n.split(".");if(1==o.length)return n;for(;o[1].length>0&&o[1].endsWith("0");)o[1]=o[1].slice(0,-1);return 0==o[1].length?n:o[0]+"."+o[1]}var unitTest=trimZeroes("50000");function createInfNum(e){const n=trimZeroes(e).split(".");return 1==n.length?infNum(BigInt(n[0]),0n):infNum(BigInt(n[0]+""+n[1]),BigInt("-"+n[1].length))}function copyInfNum(e){return infNum(e.v+0n,e.e+0n)}function infNumMul(e,n){return infNum(e.v*n.v,e.e+n.e)}function normInfNum(e,n){var t=copyInfNum(e),o=copyInfNum(n);if(t.e===o.e)return[t,o];var r=!1,i=t,s=o;s.e<i.e&&(r=!0,i=o,s=t);var a=s.e-i.e;const c=infNum(s.v*10n**a,s.e-a);return r?[c,i]:[i,c]}function infNumAdd(e,n){const t=normInfNum(e,n);return infNum(t[0].v+t[1].v,t[0].e)}function infNumSub(e,n){const t=normInfNum(e,n);return infNum(t[0].v-t[1].v,t[0].e)}function infNumDiv(e,n){const t=normInfNum(e,n);var o=t[0],r=t[1],i=infNum(o.v/r.v,o.e-r.e),s=infNum(o.v%r.v,o.e-r.e);if(0n===s.v)return i;var a=infNumMul(s,infNum(10000000000000000n,0n));return infNumAdd(i,infNum(a.v/r.v,-16n))}console.log('trimZeroes("50000") = ['+unitTest+"] // 50000"),unitTest=trimZeroes("050"),console.log('trimZeroes("050") = ['+unitTest+"] // 50"),unitTest=trimZeroes("-050"),console.log('trimZeroes("-050") = ['+unitTest+"] // -50"),unitTest=trimZeroes("-022.00"),console.log('trimZeroes("-022.00") = ['+unitTest+"] // -22"),unitTest=trimZeroes("022.002200"),console.log('trimZeroes("022.002200") = ['+unitTest+"] // 22.0022"),unitTest=trimZeroes("-22.002200"),console.log('trimZeroes("-22.002200") = ['+unitTest+"] // -22.0022"),console.log(createInfNum("0.0")),console.log(createInfNum("0")),console.log(createInfNum("123")),console.log(createInfNum("123.456")),console.log(createInfNum("  3 ")),console.log(createInfNum("  123456789.000000000012345")),console.log(createInfNum("  -4.00321")),console.log(createInfNum("  -0.009 ")),console.log("100 * 1.5 = ... // 150 (1500, -1)"),console.log(infNumMul(createInfNum("100"),createInfNum("1.5"))),console.log("123.5 * 1.5 = ... // 185.25 (18525, -2)"),console.log(infNumMul(createInfNum("123.5"),createInfNum("1.5"))),console.log("123.5 * 1.5 = ... // 185.25 (18525, -2)"),console.log(infNumMul(createInfNum("123.5"),createInfNum("1.5"))),console.log("15000 * 0.0006 = ... // 9 (9, 0)"),console.log(infNumMul(createInfNum("15000"),createInfNum("0.0006"))),console.log("100 and 123.456"),console.log(normInfNum(createInfNum("100"),createInfNum("123.456"))),console.log("0.0321 and 5"),console.log(normInfNum(createInfNum("0.0321"),createInfNum("5"))),console.log("22 and 5"),console.log(normInfNum(createInfNum("22"),createInfNum("5"))),console.log("100 + 1.5 = ... // 101.5 (1015, -1)"),console.log(infNumAdd(createInfNum("100"),createInfNum("1.5"))),console.log("123 + 0.456 = ... // 123.456 (123456, -3)"),console.log(infNumAdd(createInfNum("123"),createInfNum("0.456"))),console.log("0.00001 + 5.05 = ... // 5.05001 (505001, -5)"),console.log(infNumAdd(createInfNum("0.00001"),createInfNum("5.05"))),console.log("100 - 1.5 = ... // 98.5 (985, -1)"),console.log(infNumSub(createInfNum("100"),createInfNum("1.5"))),console.log("123 - 0.01 = ... // 122.99 (12299, -2)"),console.log(infNumSub(createInfNum("123"),createInfNum("0.01"))),console.log("0.00001 - 50 = ... // -49.99999 (-4999999, -5)"),console.log(infNumSub(createInfNum("0.00001"),createInfNum("50")));unitTest=infNumDiv(createInfNum("50000"),createInfNum("20"));function infNumEq(e,n){const t=normInfNum(e,n);return t[0].v===t[1].v}function infNumLt(e,n){const t=normInfNum(e,n);return t[0].v<t[1].v}function infNumLe(e,n){const t=normInfNum(e,n);return t[0].v<=t[1].v}function infNumGt(e,n){if(e.v>n.v&&e.e>=n.e)return!0;const t=normInfNum(e,n);return t[0].v>t[1].v}function infNumGe(e,n){const t=normInfNum(e,n);return t[0].v>=t[1].v}function infNumToString(e){var n=e.v.toString();if(0n===e.e)return n;if(e.e>0n){let t=0n;for(;t<e.e;)n+="0",t+=1n;return n}var t=0n,o="",r=!1;for(n.startsWith("-")&&(r=!0,n=n.substr(1));t>e.e;)n.length>0?(o=n.slice(-1)+o,n=n.slice(0,-1)):o="0"+o,t-=1n;return 0==n.length&&(n="0"),r&&(n="-"+n),trimZeroes(n+"."+o)}function infNumTruncate(e){var n=copyInfNum(e);const t=n.v.toString();return t.length<=24||(n.v=BigInt(n.v.toString().substring(0,24)),n.e=n.e+BigInt(t.length-24)),n}console.log("50000 / 20 = ["+infNumToString(unitTest)+"] // 2500 (25, 2)"),console.log(unitTest),unitTest=infNumDiv(createInfNum("100"),createInfNum("7")),console.log("100 / 7 = ["+infNumToString(unitTest)+"] // 14.28571428571428..."),console.log(unitTest),unitTest=infNumDiv(createInfNum("100"),createInfNum("64")),console.log("100 / 64 = ["+infNumToString(unitTest)+"] // 1.5625 (15625, -4)"),console.log(unitTest),unitTest=infNumDiv(createInfNum("1302"),createInfNum("10.5")),console.log("1302 / 10.5 = ["+infNumToString(unitTest)+"] // 124"),console.log(unitTest),console.log("100 < 123.456 // true"),console.log(infNumLt(createInfNum("100"),createInfNum("123.456"))),console.log("0.0321 > 5 // false"),console.log(infNumGt(createInfNum("0.0321"),createInfNum("5"))),console.log("5 > 0.0321 // true"),console.log(infNumGt(createInfNum("5"),createInfNum("0.0321"))),console.log("22 === 5 // false"),console.log(infNumEq(createInfNum("22"),createInfNum("5"))),console.log("-22 > 5 // false"),console.log(infNumGt(createInfNum("-22"),createInfNum("5"))),console.log("-22 <= -22.0000 // true"),console.log(infNumLe(createInfNum("-22"),createInfNum("-22.0000"))),console.log("(22,0) // 22"),console.log(infNumToString(infNum(22n,0n))),console.log("(22,1) // 220"),console.log(infNumToString(infNum(22n,1n))),console.log("22,-1) // 2.2"),console.log(infNumToString(infNum(22n,-1n))),console.log("22,-2) // 0.22"),console.log(infNumToString(infNum(22n,-2n))),console.log("22,-4) // 0.0022"),console.log(infNumToString(infNum(22n,-4n))),console.log("(-22,0) // -22"),console.log(infNumToString(infNum(-22n,0n))),console.log("(-22,1) // -220"),console.log(infNumToString(infNum(-22n,1n))),console.log("-22,-4) // -0.0022"),console.log(infNumToString(infNum(-22n,-4n)));const sequences=[{name:"Primes-1-Step-90-turn",calcFrom:"sequence",desc:"Move 1 step forward per integer, but for primes, turn 90 degrees clockwise before moving.",computePointsAndLength:function(e){var n=[],t=0;historyParams.n>5e6&&(historyParams.n=5e6);const o=historyParams;var r=getPoint(0,0);e.direction=0;for(var i=1;i<o.n;i+=1)isPrime(i)&&(n.push(r),e.direction=e.changeDirection(e.direction)),r=e.computeNextPoint(e.direction,i,r.x,r.y),t+=1;return n.push(r),{points:n,length:t}},forcedDefaults:{v:1,n:6e4,scale:createInfNum("1.2"),offsetX:createInfNum("0.2"),offsetY:createInfNum("-0.3")},privContext:{direction:0,changeDirection:function(e){return changeDirectionDegrees(e,90)},computeNextPoint:function(e,n,t,o){return computeNextPointDegrees(e,1,t,o)}}},{name:"Primes-1-Step-45-turn",calcFrom:"sequence",desc:"Move 1 step forward per integer, but for primes, turn 45 degrees clockwise before moving.  When moving diagonally, we move 1 step on both the x and y axes, so we're actually moving ~1.414 steps diagonally.",computePointsAndLength:function(e){var n=[],t=0;historyParams.n>5e6&&(historyParams.n=5e6);const o=historyParams;var r=getPoint(0,0);e.direction=315;for(var i=1;i<o.n;i+=1)isPrime(i)&&(n.push(r),e.direction=e.changeDirection(e.direction)),r=e.computeNextPoint(e.direction,i,r.x,r.y),t+=1;return n.push(r),{points:n,length:t}},forcedDefaults:{v:1,n:6e4,scale:createInfNum("0.85"),offsetX:createInfNum("-0.07"),offsetY:createInfNum("-0.32")},privContext:{direction:0,changeDirection:function(e){return changeDirectionDegrees(e,45)},computeNextPoint:function(e,n,t,o){return computeNextPointDegrees(e,1,t,o)}}},{name:"Squares-1-Step-90-turn",calcFrom:"sequence",desc:"Move 1 step forward per integer, but for perfect squares, turn 90 degrees clockwise before moving.",computePointsAndLength:function(e){var n=[],t=0;historyParams.n>1e6&&(historyParams.n=1e6);const o=historyParams;var r=getPoint(0,0);e.direction=270;for(var i=1;i<o.n;i+=1)e.isSquare(i)&&(n.push(r),e.direction=e.changeDirection(e.direction)),r=e.computeNextPoint(e.direction,i,r.x,r.y),t+=1;return n.push(r),{points:n,length:t}},forcedDefaults:{v:1,n:5e3,scale:createInfNum("6.5"),offsetX:infNum(0n,0n),offsetY:infNum(0n,0n)},privContext:{direction:0,changeDirection:function(e){return changeDirectionDegrees(e,90)},computeNextPoint:function(e,n,t,o){return computeNextPointDegrees(e,1,t,o)},isSquare:function(e){const n=Math.sqrt(e);return n==Math.trunc(n)}}},{name:"Squares-1-Step-45-turn",calcFrom:"sequence",desc:"Move 1 step forward per integer, but for perfect squares, turn 45 degrees clockwise before moving.  When moving diagonally, we move 1 step on both the x and y axes, so we're actually moving ~1.414 steps diagonally.",computePointsAndLength:function(e){var n=[],t=0;historyParams.n>1e6&&(historyParams.n=1e6);const o=historyParams;var r=getPoint(0,0);e.direction=270;for(var i=1;i<o.n;i+=1)e.isSquare(i)&&(n.push(r),e.direction=e.changeDirection(e.direction)),r=e.computeNextPoint(e.direction,i,r.x,r.y),t+=1;return n.push(r),{points:n,length:t}},forcedDefaults:{v:1,n:5e3,scale:createInfNum("2.3"),offsetX:infNum(0n,0n),offsetY:infNum(0n,0n)},privContext:{direction:0,changeDirection:function(e){return changeDirectionDegrees(e,45)},computeNextPoint:function(e,n,t,o){return computeNextPointDegrees(e,1,t,o)},isSquare:function(e){const n=Math.sqrt(e);return n==Math.trunc(n)}}},{name:"Primes-X-Y-neg-mod-3",calcFrom:"sequence",desc:"Where each plotted point <code>(x,y)</code> consists of the primes, in order.  Those points are (2,3), (5,7), (11,13), and so on.<br/><br/>Then we take the sum of the digits of both the <code>x</code> and <code>y</code> of each point.<br/>If that sum, mod 3, is 1, the <code>x</code> is negated.<br/>If that sum, mod 3, is 2, the <code>y</code> is negated.<br/><br/>After applying the negation rule, the first three plotted points become:<br/><code>(2,3)&nbsp;&nbsp;→ sum digits = 5&nbsp;&nbsp;mod 3 = 2 → -y → (2,-3)</code><br/><code>(5,7)&nbsp;&nbsp;→ sum digits = 12 mod 3 = 0 →&nbsp;&nbsp;&nbsp;&nbsp;→ (5,7)</code><br/><code>(11,13)→ sum digits = 6&nbsp;&nbsp;mod 3 = 0 →&nbsp;&nbsp;&nbsp;&nbsp;→ (11,13)</code>",computePointsAndLength:function(e){var n=[],t=0;historyParams.n>1e6&&(historyParams.n=1e6);const o=historyParams;var r=-1,i=getPoint(0,0);n.push(i);for(var s=1;s<o.n;s+=1)if(isPrime(s))if(-1==r)r=s;else{var a=s;const e=(r.toString()+a.toString()).split("");for(var c=0,u=0;u<e.length;u++)c+=e[u];const o=c%3;1==o?r*=-1:2==o&&(a*=-1);const l=getPoint(parseFloat(r),parseFloat(a));t+=Math.hypot(l.x-i.x,l.y-i.y),n.push(l),r=-1,i=l}return{points:n,length:t}},forcedDefaults:{v:1,n:5e3,scale:createInfNum("0.08"),offsetX:infNum(0n,0n),offsetY:infNum(0n,0n)},privContext:{}},{name:"Trapped-Knight",calcFrom:"sequence",desc:"On a chessboard, where the squares are numbered in a spiral, find the squares a knight can jump to in sequence where the smallest-numbered square must always be taken.  Previously-visited squares cannot be returned to again.  After more than 2,000 jumps the knight has no valid squares to jump to, so the sequence ends.<br/><br/>Credit to The Online Encyclopedia of Integer Sequences:<br/><a target='_blank' href='https://oeis.org/A316667'>https://oeis.org/A316667</a><br/>and to Numberphile:<br/><a target='_blank' href='https://www.youtube.com/watch?v=RGQe8waGJ4w'>https://www.youtube.com/watch?v=RGQe8waGJ4w</a>",computePointsAndLength:function(e){var n=[],t=0;e.visitedSquares={};const o=historyParams;var r=getPoint(0,0);if(!e.isNumberedSquare(e,r)){let n=r;e.trackNumberedSquare(e,0,r);let t=0,o=90;for(let i=1;i<3562;i+=1)t=e.changeDirection(o),n=e.computeNextPoint(t,1,r.x,r.y),e.isNumberedSquare(e,n)?r=e.computeNextPoint(o,1,r.x,r.y):(o=t,r=n),e.trackNumberedSquare(e,i,r)}var i=getPoint(0,0);n.push(i),e.visitSquare(e,0,i);var s=[],a=-1,c=null;for(let r=0;r<o.n;r+=1){s=e.reachableSquares(i);for(let n=0;n<s.length;n++)(-1==a||e.getSquareNumber(e,s[n])<a)&&(e.isVisited(e,s[n])||(c=s[n],a=e.getSquareNumber(e,c)));if(-1==a)break;t+=Math.hypot(c.x-i.x,c.y-i.y),i=c,n.push(i),e.visitSquare(e,a,i),a=-1}return{points:n,length:t}},forcedDefaults:{v:1,n:2016,scale:infNum(15n,0n),offsetX:infNum(0n,0n),offsetY:infNum(0n,0n)},privContext:{boardPoints:{},visitedSquares:{},trackNumberedSquare:function(e,n,t){e.boardPoints[t.x+"-"+t.y]=n},isNumberedSquare:function(e,n){return n.x+"-"+n.y in e.boardPoints},getSquareNumber:function(e,n){const t=n.x+"-"+n.y;return!t in e.boardPoints&&console.log("MISSING SQUARE - "+t),e.boardPoints[t]},visitSquare:function(e,n,t){e.visitedSquares[t.x+"-"+t.y]=n},isVisited:function(e,n){return n.x+"-"+n.y in e.visitedSquares},changeDirection:function(e){return changeDirectionDegrees(e,-90)},computeNextPoint:function(e,n,t,o){return computeNextPointDegrees(e,n,t,o)},reachableSquares:function(e){return[getPoint(e.x+1,e.y-2),getPoint(e.x+2,e.y-1),getPoint(e.x+2,e.y+1),getPoint(e.x+1,e.y+2),getPoint(e.x-1,e.y-2),getPoint(e.x-2,e.y-1),getPoint(e.x-2,e.y+1),getPoint(e.x-1,e.y+2)]},isSquare:function(e){const n=Math.sqrt(e);return n==Math.trunc(n)}}},{name:"Mandelbrot-set",calcFrom:"window",desc:"The Mandelbrot set is the set of complex numbers, that when repeatedly plugged into the following simple function, does <i>not</i> run away to infinity.  The function is z<sub>n+1</sub> = z<sub>n</sub><sup>2</sup> + c.<br/>For each plotted point <code>c</code>, we repeat the above function many times.<br/>If the value jumps off toward infinity after say 10 iterations, we display a color at the pixel for point <code>c</code>.<br/>If the value doesn't go off toward infinity until say 50 iterations, we pick a quite different color for that point.<br/>If, after our alloted number of iterations has been computed, the value still hasn't gone off to infinity, we color that pixel the backgrond color (defaulting to black).<br/><br/>Wikipedia has a terrific <a target='_blank' href='https://en.wikipedia.org/wiki/Mandelbrot_set'>article with pictures</a>.<br/><br/>My favorite explanation I've found so far is <a target='_blank' href='https://www.youtube.com/watch?v=FFftmWSzgmk'>this Numberphile video on YouTube</a>.<br/><br/><b>Tips for using this Mandelbrot set viewer</b>:<br/>- When not zoomed in very far, keep the <code>n</code> (iterations) parameter low for faster calculation (use N and M keys to decrease/increase the <code>n</code> value).<br/>- To see more detail when zoomed in, increase the <code>n</code> (iterations) parameter with the M key.  Calculations will be slower.<br/><br/><b>Known Issues:</b><br/>- When zoomed in beyond a certain point, the keyboard zoom/pan keys stop working as expected.  Use the mouse to zoom and pan.<br/>- When panning or zooming, the screen initially shows black instead of a low-resolution preview",computeBoundPointColor:function(e,n,t){const o=historyParams.n;for(var r=infNum(0n,0n),i=infNum(0n,0n),s=infNum(0n,0n),a=infNum(0n,0n),c=infNum(0n,0n),u=0;u<o&&!infNumGt(infNumAdd(s=infNumMul(r,r),a=infNumMul(i,i)),e.boundsRadiusSquared);)c=infNumAdd(n,infNumSub(s,a)),i=infNumAdd(t,infNumMul(e.two,infNumMul(r,i))),r=infNumTruncate(r=c),i=infNumTruncate(i),u++;return u==o?-1:e.applyColorCurve(u/o)},forcedDefaults:{n:50,scale:infNum(400n,0n),offsetX:infNum(19n,-2n),offsetY:infNum(0n,0n)},privContext:{two:infNum(2n,0n),black:getColor(0,0,0),boundsRadiusSquared:infNum(4n,0n),colors:{},applyColorCurve:function(e){const n=-.76991*e*e+1.73351*e+.0250757;return n<0?0:n>1?1:n},circles:[{centerX:createInfNum("-0.29"),centerY:infNum(0n,0n),radSq:createInfNum("0.18")},{centerX:createInfNum("-0.06"),centerY:createInfNum("0.22"),radSq:createInfNum("0.13")},{centerX:createInfNum("-0.06"),centerY:createInfNum("-0.22"),radSq:createInfNum("0.13")},{centerX:createInfNum("-1.0"),centerY:createInfNum("0.0"),radSq:createInfNum("0.04")}]}}];function isComputationComplete(){return 0==windowCalc.xPixelChunks.length}function computeBoundPoints(e){runWindowBoundPointsCalculators(e)}function runWindowBoundPointsCalculators(e){const n=Math.round(windowCalc.lineWidth),t=dContext.canvas.width;var o=128;64==n||32==n?o=1:16==n?o=32:8!=n&&4!=n||(o=64);var r,i=t/o;r=Math.trunc(i/n)+1;for(var s=0,a=[],c=0;c<t;c+=n)++s>r&&(windowCalc.xPixelChunks.push(a),s=1,a=[]),a.push(c);windowCalc.xPixelChunks.push(a),windowCalc.totalChunks=windowCalc.xPixelChunks.length,waitAndDrawWindow()}function computeBoundPointsChunk(e,n,t,o,r,i){var s=Date.now();const a=e.privContext;var c=[];const u=createInfNum(Math.round(windowCalc.lineWidth).toString()),l=createInfNum(dContext.canvas.height.toString());for(var m=0,f=0,d=infNum(0n,0n),h=0;h<i.length;h++){d=infNum(BigInt(i[h]),0n),m=infNumAdd(infNumMul(windowCalc.eachPixUnits,d),n);for(var g=infNum(0n,0n);infNumLt(g,l);){const n=infNumToString(d)+","+infNumToString(g);if(n in windowCalc.pointsCache)windowCalc.cachedPoints++,c.push(windowCalc.pointsCache[n]);else{f=infNumAdd(infNumMul(windowCalc.eachPixUnits,g),t);const o=e.computeBoundPointColor(a,m,f);var p=getColorPoint(parseInt(infNumToString(d)),parseInt(infNumToString(g)),o);windowCalc.pointsCache[n]=p,c.push(p)}g=infNumAdd(g,u)}}return windowCalc.totalTimeMs+=Date.now()-s,windowCalc.totalPoints+=c.length,windowCalc.chunksComplete++,{points:c}}const presets=[{seq:"Primes-1-Step-90-turn",v:1,n:6e4,lineWidth:1,scale:createInfNum("1.35"),offsetX:createInfNum("0.22"),offsetY:createInfNum("-0.34"),lineColor:"rbgyo",bgColor:"b"},{seq:"Trapped-Knight",v:1,n:2016,lineWidth:1.5,scale:createInfNum("15.0"),offsetX:createInfNum("0"),offsetY:createInfNum("0"),lineColor:"rbgyo",bgColor:"b"},{seq:"Primes-1-Step-45-turn",v:1,n:32400,lineWidth:2,scale:createInfNum("10.95"),offsetX:createInfNum("-0.30847"),offsetY:createInfNum("-0.96171"),lineColor:"rbgyo",bgColor:"b"},{seq:"Mandelbrot-set",v:1,n:450,lineWidth:1,scale:createInfNum("1465819.0982171979091827284292"),offsetX:createInfNum("-308.168814648192707"),offsetY:createInfNum("-12.1356456670334135"),lineColor:"rbgyo",bgColor:"b"}];for(var menuHtml="<div class='sequence-desc'><b>Presets:</b>",i=0;i<presets.length;i++)menuHtml+="<button style='float:none; margin:0.5rem; width:2.0rem;' class='preset-view-btn' id='preset-view-btn-"+(i+1)+"'>"+(i+1)+"</button>";menuHtml+="</div>";const sequencesByName={};for(i=0;i<sequences.length;i++)sequencesByName[sequences[i].name]=sequences[i],menuHtml+="<div class='sequence-desc'><button class='seq-view-btn' id='seq-view-btn-"+i+"'>View</button><b>"+sequences[i].name+"</b><br/>"+sequences[i].desc+"</div>";document.getElementById("menu-contents").innerHTML=menuHtml;const viewButtons=document.getElementsByClassName("seq-view-btn");var activateSequenceHandler=function(e){var n=parseInt(e.target.id.split("-")[3]);n>=sequences.length&&(n=0);const t=sequences[n].name;if(t!=historyParams.seq){var o=Object.assign(historyParams,sequences[n].forcedDefaults);o.seq=t,replaceHistoryWithParams(o),parseUrlParams(),start()}};for(i=0;i<viewButtons.length;i++)viewButtons[i].addEventListener("click",activateSequenceHandler);function activatePreset(e){replaceHistoryWithParams(e),parseUrlParams(),start()}const presetButtons=document.getElementsByClassName("preset-view-btn");var activatePresetHandler=function(e){var n=parseInt(e.target.id.split("-")[3])-1;(n<0||n>=presets.length)&&(n=0),activatePreset(presets[n])};for(i=0;i<presetButtons.length;i++)presetButtons[i].addEventListener("click",activatePresetHandler);function changeDirectionDegrees(e,n){for(var t=e+n;t<0;)t+=360;for(;t>=360;)t-=360;return t}function computeNextPointDegrees(e,n,t,o){return 0==e?getPoint(t+n,o):45==e?getPoint(t+n,o+n):90==e?getPoint(t,o+n):135==e?getPoint(t-n,o+n):180==e?getPoint(t-n,o):getPoint(225==e?t-n:270==e?t:t+n,o-n)}function isPrime(e){if(e<2)return!1;const n=Math.sqrt(e);for(var t=2;t<=n;t++)if(e%t==0)return!1;return!0}function getPoint(e,n){return{x:e,y:n}}function getColor(e,n,t){return{r:e,g:n,b:t}}function getColorPoint(e,n,t){return{x:e,y:n,c:t}}function parseUrlParams(){var e=new URLSearchParams(document.location.search),n={seq:"Primes-1-Step-90-turn",v:1,n:6e4,lineWidth:1,scale:createInfNum("1.35"),offsetX:createInfNum("0.22"),offsetY:createInfNum("-0.34"),lineColor:"rbgyo",bgColor:"b"};if(e.has("v")&&1==e.get("v")){if(e.has("seq")){const t=e.get("seq");t in sequencesByName?n.seq=t:alert("no such sequence ["+t+"]")}if(e.has("n")&&(n.n=parseInt(e.get("n")),n.n<0&&(n.n=100)),e.has("scale")&&(n.scale=createInfNum(e.get("scale"))),e.has("offsetX")&&(n.offsetX=createInfNum(e.get("offsetX"))),e.has("offsetY")&&(n.offsetY=createInfNum(e.get("offsetY"))),e.has("lineColor")){const t=e.get("lineColor");t in lineColorSchemes?n.lineColor=t:alert("no such line color scheme ["+t+"]")}if(e.has("bgColor")){const t=e.get("bgColor");t in bgColorSchemes?n.bgColor=t:alert("no such background color scheme ["+t+"]")}e.has("lineWidth")&&(n.lineWidth=sanityCheckLineWidth(parseFloat(e.get("lineWidth"))||1,!1,sequencesByName[n.seq]))}console.log(n),historyParams=n}function indicateActiveSequence(){const e=document.getElementsByClassName("seq-view-btn");for(var n=0;n<e.length;n++)sequences[n].name==historyParams.seq?(e[n].innerHTML="Active",e[n].parentNode.classList.add("active-seq")):(e[n].innerHTML="View",e[n].parentNode.classList.remove("active-seq"))}function start(){null!=windowCalc.timeout&&window.clearTimeout(windowCalc.timeout),points.length=0;const e=historyParams;if(!e.seq in sequencesByName)return void console.log("invalid seq parameter: no such sequence ["+e.seq+"]");indicateActiveSequence(),setDScaleVars(dContext);const n=sequencesByName[e.seq];if("sequence"==n.calcFrom){const o=n.computePointsAndLength(n.privContext);totalLength=o.length;for(var t=0;t<o.points.length;t++)points.push(o.points[t]);drawPoints(e)}else"window"==n.calcFrom?(resetWindowCalcCache(),resetWindowCalcContext(),calculateAndDrawWindow()):alert('Unexpected "calcFrom" field for the sequence: ['+n.calcFrom+"]")}const bgColorSchemes={b:"rgba(0,0,0,1.0)",g:"rgba(51,51,51,1.0)",w:"rgba(255,255,255,1.0)"},bgColorSchemeNames=[];for(let e in bgColorSchemes)bgColorSchemeNames.push(e);function getBgColor(){return historyParams.bgColor in bgColorSchemes?bgColorSchemes[historyParams.bgColor]:"rgba(0,0,0,1.0)"}function fillBg(e){var n=e.canvas;e.fillStyle=getBgColor(),e.fillRect(0,0,n.width,n.height)}function setDScaleVars(e){var n=e.canvas;n.width==n.offsetWidth&&n.height==n.offsetHeight||(n.width=n.offsetWidth,n.height=n.offsetHeight,fillBg(e))}function replaceHistoryWithParams(e){var n=Object.assign({},e);n.scale=infNumToString(e.scale),n.offsetX=infNumToString(infNumTruncate(e.offsetX)),n.offsetY=infNumToString(infNumTruncate(e.offsetY)),history.replaceState("",document.title,document.location.pathname+"?"+new URLSearchParams(n).toString()),replaceStateTimeout=null}var replaceHistory=function(){replaceHistoryWithParams(historyParams)},pushToHistory=function(){var e=Object.assign({},historyParams);e.scale=infNumToString(historyParams.scale),e.offsetX=infNumToString(infNumTruncate(historyParams.offsetX)),e.offsetY=infNumToString(infNumTruncate(historyParams.offsetY)),history.pushState("",document.title,document.location.pathname+"?"+new URLSearchParams(e).toString()),historyTimeout=null};const lineColorSchemes={rby:function(e){if(e<.5){const n=parseInt(2*e*240);return"rgba("+(240-n)+",0,"+n+",1.0)"}{const n=240-parseInt(2*(e-.5)*240);return"rgba("+(240-n)+","+(240-n)+","+n+",1.0)"}},rbgyo:function(e){if(e<.25){const n=parseInt(4*e*240);return"rgba("+(240-n)+",0,"+n+",1.0)"}if(e<.5){const n=parseInt(4*(e-.25)*240);return"rgba(0,"+n+","+(240-n)+",1.0)"}if(e<.75){return"rgba("+(240-(240-parseInt(4*(e-.5)*240)))+",240,0,1.0)"}return"rgba(240,"+(240-parseInt(4*(e-.75)*240)/2)+",0,1.0)"},br:function(e){const n=parseInt(240*e);return"rgba("+n+",0,"+(240-n)+",1.0)"},by:function(e){const n=parseInt(240*e);return"rgba("+n+","+n+","+(240-n)+",1.0)"},op:function(e){const n=parseInt(240*e);return"rgba(240,"+(120-n/2)+","+n+",1.0)"},lgdg:function(e){const n=parseInt(150*e);return"rgba("+(200-n)+","+(200-n)+","+(200-n)+",1.0)"},r:function(e){const n=200-parseInt(80*e);return"rgba("+n+","+.2*n+","+.2*n+",1.0)"},o:function(e){const n=200-parseInt(80*e);return"rgba("+n+","+.5*n+",0,1.0)"},y:function(e){const n=200-parseInt(80*e);return"rgba("+n+","+n+",0,1.0)"},g:function(e){const n=200-parseInt(80*e);return"rgba("+.1*n+","+n+","+.1*n+",1.0)"},b:function(e){const n=200-parseInt(80*e);return"rgba("+.1*n+","+.1*n+","+n+",1.0)"},p:function(e){const n=200-parseInt(80*e);return"rgba("+n+","+.1*n+","+n+",1.0)"},dg:function(e){const n=60-parseInt(30*e);return"rgba("+n+","+n+","+n+",1.0)"},lg:function(e){const n=200-parseInt(80*e);return"rgba("+n+","+n+","+n+",1.0)"}},lineColorSchemeNames=[];for(let e in lineColorSchemes)lineColorSchemeNames.push(e);function getLineColor(e,n){return n in lineColorSchemes?lineColorSchemes[n](e):"rgba(200,200,200,1.0)"}function redraw(){const e=sequencesByName[historyParams.seq];"sequence"==e.calcFrom?drawPoints(historyParams):"window"==e.calcFrom&&(resetWindowCalcContext(),calculateAndDrawWindow())}function infNumToFloat(e){return parseFloat(infNumToString(e))}function drawPoints(e){null!=replaceStateTimeout&&window.clearTimeout(replaceStateTimeout),replaceStateTimeout=window.setTimeout(replaceHistory,250);const n=dContext.canvas,t=e.lineWidth,o=infNumToFloat(e.scale),r=n.width*(.5+infNumToFloat(e.offsetX)),i=n.height*(.5+infNumToFloat(e.offsetY));fillBg(dContext),console.log("drawing ["+points.length+"] points with a total length of ["+totalLength+"]");var s=0,a=totalLength*o,c=1*r,u=1*i,l=0,m=0;dContext.lineWidth=t,dContext.lineCap="round",dContext.lineJoin="round",dContext.beginPath(),dContext.moveTo(r,i);for(var f=0;f<points.length;f++){var d=points[f].x*o+r,h=points[f].y*o+i;f>0&&(m=h-u,s+=0==(l=d-c)?Math.abs(m):0==m?Math.abs(l):Math.hypot(l,m)),dContext.beginPath(),dContext.moveTo(c,u),dContext.strokeStyle=getLineColor(s/a,e.lineColor),dContext.lineTo(d,h),dContext.stroke(),c=d,u=h}}function resetWindowCalcCache(){windowCalc.pointsCache={}}function resetWindowCalcContext(){null!=windowCalc.timeout&&window.clearTimeout(windowCalc.timeout),fillBg(dContext);const e=historyParams;windowCalc.seqName=e.seq,windowCalc.lineWidth=128,windowCalc.pixelsImage=dContext.createImageData(dContext.canvas.width,dContext.canvas.height),windowCalc.xPixelChunks=[],windowCalc.resultPoints=[],windowCalc.pointsBounds="",windowCalc.totalTimeMs=0,windowCalc.totalPoints=0,windowCalc.cachedPoints=0,windowCalc.chunksComplete=0,windowCalc.totalChunks=0;const n=createInfNum("0.5"),t=createInfNum(dContext.canvas.offsetWidth.toString()),o=createInfNum(dContext.canvas.offsetHeight.toString());windowCalc.eachPixUnits=infNumDiv(infNum(1n,0n),e.scale);const r=infNumDiv(t,e.scale),i=infNumSub(r,infNumMul(r,infNumAdd(n,e.offsetX))),s=infNumSub(i,r),a=infNumDiv(o,e.scale),c=infNumSub(a,infNumMul(a,infNumAdd(n,e.offsetY))),u=infNumSub(c,a);windowCalc.n==e.n&&infNumEq(windowCalc.leftEdge,s)&&infNumEq(windowCalc.topEdge,u)&&infNumEq(windowCalc.rightEdge,i)&&infNumEq(windowCalc.bottomEdge,c)||(windowCalc.pointsCache={}),windowCalc.n=e.n,windowCalc.leftEdge=s,windowCalc.topEdge=u,windowCalc.rightEdge=i,windowCalc.bottomEdge=c}function calculateAndDrawWindow(){drawCalculatingNotice(dContext),window.setTimeout(calculateAndDrawWindowInner,50)}function calculateAndDrawWindowInner(){const e=historyParams,n=sequencesByName[e.seq],t=Math.round(e.lineWidth),o=Math.round(windowCalc.lineWidth/2);windowCalc.lineWidth=o<=t?t:o,computeBoundPoints(n.privContext)}function waitAndDrawWindow(){const e=sequencesByName[windowCalc.seqName];var n=windowCalc.xPixelChunks.shift();const t=isComputationComplete();if(n){const r=computeBoundPointsChunk(e,windowCalc.leftEdge,windowCalc.topEdge,windowCalc.rightEdge,windowCalc.bottomEdge,n);for(var o=0;o<r.points.length;o++)points.push(r.points[o]);drawColorPoints(),t||drawCalculatingNotice(dContext)}null!=windowCalc.timeout&&window.clearTimeout(windowCalc.timeout),t?(console.log("computing ["+windowCalc.totalPoints+"] points, of which ["+windowCalc.cachedPoints+"] were cached, took ["+windowCalc.totalTimeMs+"] ms"),Math.round(windowCalc.lineWidth)>Math.round(historyParams.lineWidth)&&(windowCalc.chunksComplete=0,windowCalc.timeout=window.setTimeout(calculateAndDrawWindow,250))):windowCalc.timeout=window.setTimeout(waitAndDrawWindow,25)}function drawColorPoints(){null!=replaceStateTimeout&&window.clearTimeout(replaceStateTimeout),replaceStateTimeout=window.setTimeout(replaceHistory,250);const e=Math.round(windowCalc.lineWidth),n=dContext.canvas,t=n.width,o=n.height,r=windowCalc.pixelsImage;for(var i=0;i<points.length;i++){const n=points[i].x,l=points[i].y,m=points[i].c;var s=getBgColor();m>=0&&(s=getLineColor(m,historyParams.lineColor));const f=s.substr(5).split(",");s=getColor(parseInt(f[0]),parseInt(f[1]),parseInt(f[2]));for(var a=0,c=0;c<e&&!(n+c>=t);c++)for(var u=0;u<e&&!(l+u>=o);u++)a=4*((l+u)*t+(n+c)),r.data[a+0]=s.r,r.data[a+1]=s.g,r.data[a+2]=s.b,r.data[a+3]=255}dContext.putImageData(r,0,0)}function drawCalculatingNotice(e){const n=e.canvas;e.fillStyle="rgba(100,100,100,0.7)";const t=Math.max(24,.03*n.height),o=Math.round(.6*t),r=Math.max(200,18*o);e.fillRect(0,n.height-t,r,t),e.font=o+"px system-ui",e.fillStyle="rgba(0,0,0,0.9)";const i=Math.round(100*windowCalc.chunksComplete/windowCalc.totalChunks);e.fillText("Calculating "+windowCalc.lineWidth+"-wide pixels ("+i+"%) ...",Math.round(.2*t),n.height-Math.round(.2*t))}function addParamPercentAndRound(e,n){if(!e in historyParams)return void console.log("unknown params field ["+e+"]");const t=infNumAdd(infNumMul(historyParams[e],infNum(100n,0n)),createInfNum(n.toString())),o=infNumDiv(createInfNum(infNumToString(t).split(".")[0]),infNum(100n,0n));historyParams[e]=o}function applyParamPercent(e,n){if(!e in historyParams)return void console.log("unknown params field ["+e+"]");const t=createInfNum(n);if(infNumLe(t,infNum(0n,0n)))return void console.log("cannot apply a zero or negative percentage to field ["+e+"]");const o=infNumMul(historyParams[e],t);historyParams[e]=o}function roundTo2Decimals(e){var n=Math.round(100*e);return parseFloat(n/100)}function roundTo5Decimals(e){var n=Math.round(1e5*e);return parseFloat(n/1e5)}function sanityCheckLineWidth(e,n,t){if(e<.5)return.5;if("window"==t.calcFrom){if(e>64)return n?.5:64}else if(e>20)return n?.5:20;return e}window.addEventListener("keydown",(function(e){if(39==e.keyCode)addParamPercentAndRound("offsetX",-1),redraw();else if(68==e.keyCode)addParamPercentAndRound("offsetX",-10),redraw();else if(37==e.keyCode)addParamPercentAndRound("offsetX",1),redraw();else if(65==e.keyCode)addParamPercentAndRound("offsetX",10),redraw();else if(38==e.keyCode)addParamPercentAndRound("offsetY",1),redraw();else if(87==e.keyCode)addParamPercentAndRound("offsetY",10),redraw();else if(40==e.keyCode)addParamPercentAndRound("offsetY",-1),redraw();else if(83==e.keyCode)addParamPercentAndRound("offsetY",-10),redraw();else if(61==e.keyCode||107==e.keyCode)applyParamPercent("scale","1.01"),redraw();else if(173==e.keyCode||109==e.keyCode)applyParamPercent("scale","0.99"),infNumLt(historyParams.scale,infNum(1n,-2n))&&(historyParams.scale=createInfNum("0.01")),redraw();else if(69==e.keyCode)applyParamPercent("scale","1.05"),redraw();else if(81==e.keyCode)applyParamPercent("scale","0.95"),infNumLt(historyParams.scale,infNum(0n,0n))&&(historyParams.scale=createInfNum("0.01")),redraw();else if(67==e.keyCode)historyParams.offsetX=createInfNum("0"),historyParams.offsetY=createInfNum("0"),redraw();else if(77==e.keyCode)"sequence"==sequencesByName[historyParams.seq].calcFrom?historyParams.n+=500:historyParams.n+=100,start();else if(78==e.keyCode)"sequence"==sequencesByName[historyParams.seq].calcFrom?historyParams.n>100&&(historyParams.n-=100):historyParams.n>10&&(historyParams.n-=10),start();else if(86==e.keyCode){let e=-1;for(let n=0;n<lineColorSchemeNames.length;n++)if(lineColorSchemeNames[n]==historyParams.lineColor){e=n;break}e+=1,e>=lineColorSchemeNames.length&&(e=0),historyParams.lineColor=lineColorSchemeNames[e],redraw()}else if(66==e.keyCode){let e=-1;for(let n=0;n<bgColorSchemeNames.length;n++)if(bgColorSchemeNames[n]==historyParams.bgColor){e=n;break}e+=1,e>=bgColorSchemeNames.length&&(e=0),historyParams.bgColor=bgColorSchemeNames[e],redraw()}else if(88==e.keyCode){let e=-1;for(let n=0;n<sequences.length;n++)if(sequences[n].name==historyParams.seq){e=n;break}e+=1,e>=sequences.length&&(e=0),historyParams.seq=sequences[e].name,replaceHistoryWithParams(Object.assign(historyParams,sequences[e].forcedDefaults)),parseUrlParams(),start()}else if(90==e.keyCode){let e=Math.round(100*historyParams.lineWidth);e+=50,historyParams.lineWidth=parseFloat(e/100),historyParams.lineWidth=sanityCheckLineWidth(historyParams.lineWidth,!0,sequencesByName[historyParams.seq]),"window"==sequencesByName[historyParams.seq].calcFrom?start():redraw()}else 72==e.keyCode?helpVisible?closeHelpMenu():openHelpMenu():80==e.keyCode?menuVisible?closeMenu():openMenu():49==e.keyCode||97==e.keyCode?activatePreset(presets[0]):50==e.keyCode||98==e.keyCode?activatePreset(presets[1]):51!=e.keyCode&&99!=e.keyCode||activatePreset(presets[2])})),window.addEventListener("resize",(function(){null!==resizeTimeout&&window.clearTimeout(resizeTimeout),resizeTimeout=window.setTimeout((function(){setDScaleVars(dContext),redraw()}),500)}));var mouseDownHandler=function(e){e.preventDefault(),"touches"in e&&"1"in e.touches&&(pinch=!0,pinchStartDist=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY)),mouseDrag=!0,mouseDragX=e.pageX,mouseDragY=e.pageY};dCanvas.addEventListener("mousedown",mouseDownHandler),dCanvas.addEventListener("touchstart",mouseDownHandler);var mouseMoveHandler=function(e){if(e.preventDefault(),!mouseDrag)return;const n=e.pageX,t=e.pageY,o=(mouseDragX-n)/dCanvas.width,r=(mouseDragY-t)/dCanvas.height;if(historyParams.offsetX=infNumSub(historyParams.offsetX,createInfNum(o.toString())),historyParams.offsetY=infNumSub(historyParams.offsetY,createInfNum(r.toString())),mouseDragX=n,mouseDragY=t,"touches"in e&&"1"in e.touches){const n=(e.touches[0].pageX+e.touches[1].pageX)/2,t=(e.touches[0].pageY+e.touches[1].pageY)/2,o=historyParams.scale,r=Math.hypot(e.touches[0].pageX-e.touches[1].pageX,e.touches[0].pageY-e.touches[1].pageY),i=r/pinchStartDist;pinchStartDist=r;const s=infNumMul(historyParams.scale,createInfNum(i.toString())),a=createInfNum("500"),c=createInfNum("0.00005");"sequence"==sequencesByName[historyParams.seq].calcFrom?infNumLt(s,c)?historyParams.scale=c:infNumGt(s,a)?historyParams.scale=a:historyParams.scale=s:historyParams.scale=s;const u=calculateNewZoomOffset(createInfNum(n.toString()),createInfNum(dCanvas.width.toString()),historyParams.offsetX,o,historyParams.scale),l=calculateNewZoomOffset(createInfNum(t.toString()),createInfNum(dCanvas.height.toString()),historyParams.offsetY,o,historyParams.scale);historyParams.offsetX=u,historyParams.offsetY=l}redraw()};dCanvas.addEventListener("mousemove",mouseMoveHandler),dCanvas.addEventListener("touchmove",mouseMoveHandler);var mouseUpHandler=function(e){e.preventDefault(),mouseDrag=!1,pinch=!1};function calculateNewZoomOffset(e,n,t,o,r){const i=infNumMul(n,infNumAdd(createInfNum("0.5"),t));return infNumAdd(infNumMul(infNumDiv(infNumSub(e,i),o),infNumDiv(infNumSub(o,r),n)),t)}function closeMenu(){menuVisible=!1,hideFooter(),document.getElementById("menu").style.display="none",document.getElementById("menu-open-wrap").style.display="block"}function openMenu(){menuVisible=!0,closeHelpMenu(),showFooter(),document.getElementById("menu").style.display="block",document.getElementById("menu-open-wrap").style.display="none"}function closeHelpMenu(){helpVisible=!1,hideFooter(),document.getElementById("help-menu").style.display="none",document.getElementById("menu-open-wrap").style.display="block"}function openHelpMenu(){closeMenu(),showFooter(),helpVisible=!0,document.getElementById("help-menu").style.display="block",document.getElementById("menu-open-wrap").style.display="none"}function showFooter(){document.getElementById("footer").style.display="block"}function hideFooter(){document.getElementById("footer").style.display="none"}dCanvas.addEventListener("mouseup",mouseUpHandler),dCanvas.addEventListener("touchend",mouseUpHandler),dCanvas.addEventListener("wheel",(function(e){const n=historyParams.scale;var t=createInfNum((1+e.wheelDeltaY/48*.05).toString());infNumLt(t,createInfNum("0"))&&(console.log("NEGATIVE scale factor would have been applied: ["+infNumToString(t)+"]"),t=createInfNum("0.05"));const o=infNumMul(historyParams.scale,t),r=createInfNum("500"),i=createInfNum("0.00005");"sequence"==sequencesByName[historyParams.seq].calcFrom?infNumLt(o,i)?historyParams.scale=i:infNumGt(o,r)?historyParams.scale=r:historyParams.scale=o:historyParams.scale=o;const s=calculateNewZoomOffset(createInfNum(e.pageX.toString()),createInfNum(dCanvas.width.toString()),historyParams.offsetX,n,historyParams.scale),a=calculateNewZoomOffset(createInfNum(e.pageY.toString()),createInfNum(dCanvas.height.toString()),historyParams.offsetY,n,historyParams.scale);historyParams.offsetX=s,historyParams.offsetY=a,redraw()})),document.getElementById("menu-open").addEventListener("click",(function(e){openMenu()}),!0),document.getElementById("menu-close").addEventListener("click",(function(e){closeMenu(),closeHelpMenu()}),!0),document.getElementById("help-menu-open").addEventListener("click",(function(e){openHelpMenu()}),!0),document.getElementById("help-menu-close").addEventListener("click",(function(e){closeHelpMenu()}),!0),parseUrlParams(),start();