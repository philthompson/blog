// as of 2021-11-09, minify with https://codebeautify.org/minify-js
const forceWorkerReloadUrlParam="force-worker-reload=true",forceWorkerReload=self.location.toString().includes(forceWorkerReloadUrlParam),urlParams=new URLSearchParams(self.location.search),appVersion=urlParams.has("v")?urlParams.get("v"):"unk";forceWorkerReload?(importScripts("infnum.js?v="+appVersion+"&"+"force-worker-reload=true&t="+Date.now()),importScripts("floatexp.js?v="+appVersion+"&"+"force-worker-reload=true&t="+Date.now()),importScripts("plots.js?v="+appVersion+"&"+"force-worker-reload=true&t="+Date.now())):(importScripts("infnum.js?v="+appVersion),importScripts("floatexp.js?v="+appVersion),importScripts("plots.js?v="+appVersion));const plotsByName={};for(let e=0;e<plots.length;e++)plotsByName[plots[e].name]=plots[e];var lastComputeChunkMsg=null,referencePx=null,referencePy=null,referenceOrbit=null,referencePlotId=null,referenceBlaTables=null,saCoefficients=null;self.onmessage=function(e){if("compute-chunk"==e.data.t?(lastComputeChunkMsg=e.data.v,null!==referencePlotId&&lastComputeChunkMsg.chunk.plotId!==referencePlotId&&(referenceOrbit=null,referenceBlaTables=null,saCoefficients=null)):"reference-orbit"==e.data.t?(referencePx=e.data.v.referencePx,referencePy=e.data.v.referencePy,referenceOrbit=e.data.v.referenceOrbit,referencePlotId=e.data.v.referencePlotId):"bla-tables"==e.data.t?(referencePx=e.data.v.referencePx,referencePy=e.data.v.referencePy,referenceBlaTables=e.data.v.referenceBlaTables,referencePlotId=e.data.v.referencePlotId):"sa-coefficients"==e.data.t?(referencePx=e.data.v.referencePx,referencePy=e.data.v.referencePy,saCoefficients=e.data.v.saCoefficients,referencePlotId=e.data.v.referencePlotId):console.log("subworker received unknown message:",e),null!==lastComputeChunkMsg)if(null===referenceOrbit&&(lastComputeChunkMsg.chunk.algorithm.includes("perturb-")||lastComputeChunkMsg.chunk.algorithm.includes("bla-")||lastComputeChunkMsg.chunk.algorithm.includes("sapx")))postMessage({t:"send-reference-orbit",v:0});else if(null===referenceBlaTables&&lastComputeChunkMsg.chunk.algorithm.includes("bla-"))postMessage({t:"send-bla-tables",v:0});else if(null===saCoefficients&&lastComputeChunkMsg.chunk.algorithm.includes("sapx"))postMessage({t:"send-sa-coefficients",v:0});else{let e=lastComputeChunkMsg;lastComputeChunkMsg=null,computeChunk(e.plotId,e.chunk,e.cachedIndices)}};var computeChunk=function(e,r,n){let t=r.chunkPos.x,l=r.chunkPos.y,o=r.chunkInc.y;const a=plotsByName[r.plot].computeBoundPointColor;let s=normInfNum(l,o);l=s[0],o=s[1];let c=0,u=0,i=0;if(1===n.length&&-1===n[0])return r.results=[],r.plotId=e,r.blaPixelsCount=c,r.blaIterationsSkipped=u,r.blaSkips=i,void postMessage({t:"completed-chunk",v:r});const f=new Array(r.chunkLen);if(n.length<r.chunkLen)if(r.algorithm.includes("basic-"))for(let e=0;e<r.chunkLen;e++)binarySearchIncludesNumber(n,e)||(f[e]=a(r.chunkN,r.chunkPrecision,r.algorithm,t,l)),l=infNumAddNorm(l,o);else if(r.algorithm.includes("perturb-")){const e=plotsByName[r.plot].computeBoundPointColorPerturbOrBla;for(let a=0;a<r.chunkLen;a++)binarySearchIncludesNumber(n,a)||(f[a]=e(r.chunkN,r.chunkPrecision,t,l,r.algorithm,referencePx,referencePy,referenceOrbit,referenceBlaTables,saCoefficients).colorpct),l=infNumAddNorm(l,o)}else if(r.algorithm.includes("bla-")){const e=plotsByName[r.plot].computeBoundPointColorPerturbOrBla;for(let a=0;a<r.chunkLen;a++){if(!binarySearchIncludesNumber(n,a)){f[a]=e(r.chunkN,r.chunkPrecision,t,l,r.algorithm,referencePx,referencePy,referenceOrbit,referenceBlaTables,saCoefficients);let n=e(r.chunkN,r.chunkPrecision,t,l,r.algorithm,referencePx,referencePy,referenceOrbit,referenceBlaTables,saCoefficients);f[a]=n.colorpct,c++,u+=n.blaItersSkipped,i+=n.blaSkips}l=infNumAddNorm(l,o)}}r.results=f,r.plotId=e,r.blaPixelsCount=c,r.blaIterationsSkipped=u,r.blaSkips=i,postMessage({t:"completed-chunk",v:r})};function binarySearchIncludesNumber(e,r){let n=0,t=e.length-1,l=null,o=null;for(;n<=t;)if(l=n+t>>1,o=r-e[l],o>0)n=l+1;else{if(!(o<0))return!0;t=l-1}return!1}function fnv32a(e){for(var r=2166136261,n=0;n<e.length;++n)r^=e.charCodeAt(n),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24);return r>>>0}