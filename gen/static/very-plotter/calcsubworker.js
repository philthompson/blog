// as of 2021-11-09, minify with https://codebeautify.org/minify-js
const forceWorkerReloadUrlParam="force-worker-reload=true",forceWorkerReload=self.location.toString().includes(forceWorkerReloadUrlParam),urlParams=new URLSearchParams(self.location.search),appVersion=urlParams.has("v")?urlParams.get("v"):"unk";forceWorkerReload?(importScripts("infnum.js?v="+appVersion+"&"+"force-worker-reload=true&t="+Date.now()),importScripts("floatexp.js?v="+appVersion+"&"+"force-worker-reload=true&t="+Date.now()),importScripts("plots.js?v="+appVersion+"&"+"force-worker-reload=true&t="+Date.now())):(importScripts("infnum.js?v="+appVersion),importScripts("floatexp.js?v="+appVersion),importScripts("plots.js?v="+appVersion));const plotsByName={};for(let e=0;e<plots.length;e++)plotsByName[plots[e].name]=plots[e];var lastComputeChunkMsg=null,referencePx=null,referencePy=null,referenceOrbit=null,referencePlotId=null;self.onmessage=function(e){if("compute-chunk"==e.data.t)null!==referencePlotId&&e.data.v.chunk.plotId!==referencePlotId&&(referenceOrbit=null),null===referenceOrbit&&e.data.v.chunk.algorithm.startsWith("perturb-")?(lastComputeChunkMsg=e.data.v,postMessage({t:"send-reference-orbit",v:0})):computeChunk(e.data.v.plotId,e.data.v.chunk,e.data.v.cachedIndices,referencePx,referencePy,referenceOrbit);else if("reference-orbit"==e.data.t){if(referencePx=e.data.v.referencePx,referencePy=e.data.v.referencePy,referenceOrbit=e.data.v.referenceOrbit,referencePlotId=e.data.v.referencePlotId,null!==lastComputeChunkMsg){let e=lastComputeChunkMsg;lastComputeChunkMsg=null,computeChunk(e.plotId,e.chunk,e.cachedIndices,referencePx,referencePy,referenceOrbit)}}else console.log("subworker received unknown message:",e)};var computeChunk=function(e,r,t,n,o,l){let a=r.chunkPos.x,c=r.chunkPos.y,s=r.chunkInc.y;const u=plotsByName[r.plot].computeBoundPointColor;let i=normInfNum(c,s);c=i[0],s=i[1];const p=new Array(r.chunkLen);if(t.length<r.chunkLen)if(r.algorithm.startsWith("perturb-")){const e=r.algorithm.includes("floatexp")?plotsByName[r.plot].computeBoundPointColorPerturbFloatExp:plotsByName[r.plot].computeBoundPointColorPerturbFloat;for(let u=0;u<r.chunkLen;u++)binarySearchIncludesNumber(t,u)||(p[u]=e(r.chunkN,r.chunkPrecision,a,c,n,o,l)),c=infNumAddNorm(c,s)}else for(let e=0;e<r.chunkLen;e++)binarySearchIncludesNumber(t,e)||(p[e]=u(r.chunkN,r.chunkPrecision,r.algorithm,a,c)),c=infNumAddNorm(c,s);r.results=p,r.plotId=e,postMessage({t:"completed-chunk",v:r})};function binarySearchIncludesNumber(e,r){let t=0,n=e.length-1,o=null,l=null;for(;t<=n;)if(o=t+n>>1,l=r-e[o],l>0)t=o+1;else{if(!(l<0))return!0;n=o-1}return!1}function fnv32a(e){for(var r=2166136261,t=0;t<e.length;++t)r^=e.charCodeAt(t),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24);return r>>>0}